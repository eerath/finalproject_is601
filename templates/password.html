<!DOCTYPEa html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Change Password</title>
    </head>
    <body>
        <h1>Change Password</h1>
        <form id="pwForm">
            <label>Current Password: <input type="password" id="current_password"></label>
            <br>
            <label>New Password: <input type="password" id="new_password"></label>
            <br>
            <label>Confirm New Password: <input type="password" id="confirm_new_password"></label>
            <br>
            <button type="submit">Change Password</button>
        </form>

        <script>
            var token = localStorage.getItem("access_token");

            document.getElementById('pwForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                var payload = {
                    current_password: document.getElementById('current_password').value,
                    new_password: document.getElementById('new_password').value,
                    confirm_new_password: document.GetElementById('confirm_new_password').value
                };

            var resp = await fetch('/users/me/password', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(payload)
            });

            if (resp.ok) {
                alert('Password changed successfully. Please log in again with your new password.');
                window.location.href = '/login';
            } else {
                var data = await resp.json().catch(()=>null);
                alert('Error: ' + (data?.detail || await resp.text()));
            }
            });
        </script>
    </body>
</html>